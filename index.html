<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Blackjack — GitHub Pages Demo</title>
<style>
  :root{
    --bg:#0b3b2e;
    --card:#fff;
    --panel:#0f7a66;
    --muted: #cfeee4;
    --accent: #ffd166;
  }
  body{
    margin:0;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#023b2f 0%, #042f24 60%);
    color:var(--muted);
    display:flex;
    min-height:100vh;
    align-items:flex-start;
    justify-content:center;
    padding:24px;
  }
  main{
    width:100%;
    max-width:1100px;
    background:rgba(0,0,0,0.18);
    border-radius:12px;
    padding:18px;
    box-shadow:0 8px 30px rgba(0,0,0,0.5);
    backdrop-filter: blur(6px);
  }
  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:12px;
  }
  h1{ margin:0; font-size:1.3rem; color:var(--accent);}
  .controls{
    display:flex;
    gap:8px;
    align-items:center;
  }
  select,input[type=number]{ padding:8px; border-radius:6px; border:none; font-size:0.95rem;}
  button{
    background:var(--panel);
    color:#fff;
    border:none;
    padding:10px 12px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
  }
  .layout{
    display:grid;
    grid-template-columns: 320px 1fr;
    gap:18px;
  }
  .left{
    background:rgba(255,255,255,0.03);
    padding:12px;
    border-radius:10px;
  }
  .right{
    background:rgba(255,255,255,0.02);
    padding:12px;border-radius:10px;
  }
  .table{
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .player-row{
    display:flex; gap:12px; align-items:center; padding:10px; background:rgba(0,0,0,0.15); border-radius:8px;
  }
  .cards{ display:flex; gap:8px; align-items:center; }
  .card{
    width:64px; height:92px; border-radius:8px; background:var(--card); color:#000;
    display:flex; align-items:center; justify-content:center; font-weight:700; box-shadow:0 6px 14px rgba(0,0,0,0.4);
    font-size:1.05rem;
  }
  .card.hidden{ background:linear-gradient(135deg,#333,#111); color:#fff; }
  .player-info{ flex:1; display:flex; flex-direction:column; gap:6px; }
  .player-name{ font-weight:700; color:var(--accent); }
  .player-meta{ font-size:0.9rem; color:#d7efe7;}
  .actions{ display:flex; gap:8px; }
  .log{ max-height:220px; overflow:auto; padding:8px; background:rgba(0,0,0,0.2); border-radius:8px; font-size:0.95rem;}
  .footer{ display:flex; gap:8px; justify-content:space-between; align-items:center; margin-top:12px; }
  .status{ font-weight:700; color:var(--accent); }
  .winner { color:#ffd166; font-weight:900; }
  @media (max-width:900px){
    .layout{ grid-template-columns: 1fr; }
  }
</style>
</head>
<body>
<main>
  <header>
    <h1>Blackjack — GitHub Pages (Hotseat + Bots)</h1>
    <div class="controls">
      <label for="mode">Modus</label>
      <select id="mode">
        <option value="vsDealer" selected>Gegen Dealer (klassisch)</option>
        <option value="free">Mehrspieler (gegenseitig, hotseat)</option>
      </select>

      <label for="numPlayers">Spieler</label>
      <input id="numPlayers" type="number" min="1" max="6" value="2" style="width:64px"/>

      <button id="setupBtn">Setup</button>
      <button id="startBtn">Start Spiel</button>
    </div>
  </header>

  <div class="layout">
    <section class="left">
      <h3>Einstellungen</h3>
      <div id="playersConfig" style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"></div>

      <div style="margin-top:12px;">
        <label><input id="showTotals" type="checkbox" checked/> Punktzahlen während des Spiels anzeigen</label>
      </div>

      <div style="margin-top:12px;">
        <small>Hinweis: Dieses Spiel ist für lokale Hotseat-Runden auf GitHub Pages gedacht. Echtzeit-Multiplayer zwischen Browsern benötigt Server/Signaling.</small>
      </div>
    </section>

    <section class="right">
      <div class="table" id="tableArea">
        <!-- Dynamisch -->
      </div>

      <div class="footer">
        <div class="status" id="status">Bereit.</div>
        <div>
          <button id="dealBtn" disabled>Geben</button>
          <button id="nextBtn" disabled>Nächster</button>
          <button id="resetBtn">Neu</button>
        </div>
      </div>

      <h4 style="margin-top:12px">Spielprotokoll</h4>
      <div class="log" id="log"></div>
    </section>
  </div>
</main>

<script>
/* ---------------------------
   Blackjack für GitHub Pages
   - Hotseat Multiplayer / Bots
   - Eine Datei: index.html
   --------------------------- */

class Deck {
  constructor(){
    this.cards = [];
    this.reset();
  }
  reset(){
    const suits = ['♠','♥','♦','♣'];
    const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
    this.cards = [];
    for(const s of suits){
      for(const r of ranks){
        this.cards.push({rank:r,suit:s,code: r + s});
      }
    }
    this.shuffle();
  }
  shuffle(){
    // Fisher-Yates
    for(let i=this.cards.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [this.cards[i], this.cards[j]] = [this.cards[j], this.cards[i]];
    }
  }
  draw(){
    if(this.cards.length === 0){
      this.reset();
    }
    return this.cards.pop();
  }
}

class Player {
  constructor(name, type='human'){ // type: 'human' | 'bot' | 'dealer'
    this.name = name;
    this.type = type;
    this.hand = [];
    this.stand = false;
    this.busted = false;
    this.blackjack = false;
  }
  resetHand(){
    this.hand = [];
    this.stand = false;
    this.busted = false;
    this.blackjack = false;
  }
  addCard(c){
    this.hand.push(c);
    const total = this.getBestValue();
    if(total > 21) this.busted = true;
    if(this.hand.length === 2 && total === 21) this.blackjack = true;
  }
  getBestValue(){
    // calculate best numeric hand value (A = 1 or 11)
    let sum = 0;
    let aces = 0;
    for(const c of this.hand){
      const r = c.rank;
      if(r === 'A'){ aces++; sum += 1; }
      else if(['J','Q','K'].includes(r)) sum += 10;
      else sum += parseInt(r,10);
    }
    // try upgrade aces from 1 to 11 if possible
    for(let k=0;k<aces;k++){
      if(sum + 10 <= 21) sum += 10;
    }
    return sum;
  }
}

/* ----------- GAME STATE ----------- */
const deck = new Deck();
let players = []; // includes dealer if in vsDealer mode
let currentPlayerIndex = 0;
let mode = 'vsDealer';
let showTotals = true;

/* ----------- DOM refs ----------- */
const modeSel = document.getElementById('mode');
const numPlayersInput = document.getElementById('numPlayers');
const setupBtn = document.getElementById('setupBtn');
const startBtn = document.getElementById('startBtn');
const playersConfig = document.getElementById('playersConfig');
const tableArea = document.getElementById('tableArea');
const dealBtn = document.getElementById('dealBtn');
const nextBtn = document.getElementById('nextBtn');
const resetBtn = document.getElementById('resetBtn');
const logEl = document.getElementById('log');
const statusEl = document.getElementById('status');
const showTotalsCheckbox = document.getElementById('showTotals');

/* ----------- UI helpers ----------- */
function log(msg){
  const line = document.createElement('div');
  line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
  logEl.prepend(line);
}
function clearLog(){ logEl.innerHTML = ''; }
function setStatus(s){ statusEl.textContent = s; }

/* ----------- Setup UI for player options ----------- */
function renderPlayersConfig(){
  playersConfig.innerHTML = '';
  const n = parseInt(numPlayersInput.value,10) || 1;
  for(let i=0;i<n;i++){
    const div = document.createElement('div');
    div.style.display = 'flex';
    div.style.gap = '8px';
    div.style.alignItems = 'center';
    const nameInput = document.createElement('input');
    nameInput.placeholder = `Spieler ${i+1}`;
    nameInput.value = `Player ${i+1}`;
    nameInput.style.flex='1';
    const typeSel = document.createElement('select');
    const optHuman = document.createElement('option'); optHuman.value='human'; optHuman.text='Mensch';
    const optBot = document.createElement('option'); optBot.value='bot'; optBot.text='Bot';
    typeSel.appendChild(optHuman); typeSel.appendChild(optBot);
    div.appendChild(nameInput);
    div.appendChild(typeSel);
    playersConfig.appendChild(div);
  }
}

/* ----------- Build table UI ----------- */
function renderTable(){
  tableArea.innerHTML = '';
  for(let i=0;i<players.length;i++){
    const p = players[i];
    const row = document.createElement('div');
    row.className = 'player-row';
    row.dataset.index = i;

    const info = document.createElement('div');
    info.className = 'player-info';
    const title = document.createElement('div');
    title.className = 'player-name';
    title.textContent = p.name + (p.type==='dealer' ? ' (Dealer)' : p.type==='bot' ? ' (Bot)' : '');
    const meta = document.createElement('div');
    meta.className = 'player-meta';
    meta.textContent = `Status: ${p.busted ? 'BUSTED' : p.stand ? 'Stand' : 'Bereit'}`;
    info.appendChild(title);
    info.appendChild(meta);

    const cardsWrap = document.createElement('div');
    cardsWrap.className = 'cards';
    // cards
    for(const c of p.hand){
      const cd = document.createElement('div');
      cd.className = 'card';
      cd.textContent = `${c.rank}${c.suit}`;
      cardsWrap.appendChild(cd);
    }
    // dealer's first card hidden until reveal
    if(p.type === 'dealer' && p.hand.length > 0 && mode === 'vsDealer'){
      // first card should be visible, second hidden initially (we will mark second hidden)
      // We'll mark the second card as hidden if game state before dealer reveal.
      if(!p.revealed){
        // mark second card hidden only if exists
        if(cardsWrap.children[1]){
          cardsWrap.children[1].classList.add('hidden');
          cardsWrap.children[1].textContent = '';
        }
      }
    }

    // show total optionally
    const totalWrap = document.createElement('div');
    totalWrap.style.minWidth = '90px';
    totalWrap.style.textAlign = 'right';
    const totalVal = document.createElement('div');
    totalVal.style.fontWeight = '700';
    if(showTotals){
      const val = p.getBestValue();
      totalVal.textContent = `→ ${val}`;
    } else totalVal.textContent = '';
    totalWrap.appendChild(totalVal);

    // actions for current human player
    const actions = document.createElement('div');
    actions.className = 'actions';
    if(i === currentPlayerIndex && players[currentPlayerIndex].type === 'human' && !players[i].stand && !players[i].busted){
      const hitBtn = document.createElement('button'); hitBtn.textContent = 'Hit';
      const standBtn = document.createElement('button'); standBtn.textContent = 'Stand';
      hitBtn.onclick = ()=> playerHit(i);
      standBtn.onclick = ()=> playerStand(i);
      actions.appendChild(hitBtn);
      actions.appendChild(standBtn);
    } else {
      actions.innerHTML = '';
    }

    row.appendChild(info);
    row.appendChild(cardsWrap);
    row.appendChild(totalWrap);
    row.appendChild(actions);

    tableArea.appendChild(row);
  }
}

/* ----------- Game logic ----------- */
function setupPlayersFromUI(){
  players = [];
  const children = [...playersConfig.children];
  const selMode = modeSel.value;
  for(const ch of children){
    const name = ch.querySelector('input').value.trim() || 'Spieler';
    const type = ch.querySelector('select').value;
    players.push(new Player(name, type));
  }
  if(selMode === 'vsDealer'){
    // add dealer at end
    const dealer = new Player('Dealer', 'dealer');
    dealer.revealed = false; // we'll reveal dealer's face-down later
    players.push(dealer);
  }
  currentPlayerIndex = 0;
  deck.reset();
  clearLog();
  log('Spieler gesetzt. Drücke "Start Spiel".');
  setStatus('Setup fertig.');
  renderTable();
  dealBtn.disabled = true;
  nextBtn.disabled = true;
}

function startGame(){
  if(players.length === 0){
    log('Keine Spieler. Setup zuerst ausführen.');
    return;
  }
  // reset hands
  for(const p of players) p.resetHand();
  deck.reset();
  // initial deal: 2 Karten an jeden (im klassischen modus dealer gets 2, with one hidden)
  for(let r=0;r<2;r++){
    for(let i=0;i<players.length;i++){
      const p = players[i];
      const card = deck.draw();
      p.addCard(card);
    }
  }
  // If dealer present and in vsDealer mode, mark second card hidden
  if(modeSel.value === 'vsDealer'){
    const dealer = players[players.length-1];
    dealer.revealed = false;
  }
  // check immediate blackjack
  for(const p of players){
    if(p.blackjack) log(`${p.name} hat Blackjack! (${p.getBestValue()})`);
  }
  currentPlayerIndex = 0;
  // skip dealer turn initially
  if(players[currentPlayerIndex].type === 'dealer'){
    // move to next human/bot
    advanceToNextPlayer();
  }
  renderTable();
  setStatus('Runde gestartet — Spieler 1 ist dran.');
  dealBtn.disabled = true;
  nextBtn.disabled = false;
  // if first player is bot, auto-play
  processCurrentIfBot();
}

/* Player actions */
function playerHit(index){
  const p = players[index];
  if(p.stand || p.busted) return;
  const card = deck.draw();
  p.addCard(card);
  log(`${p.name} zieht ${card.rank}${card.suit} → totale ${p.getBestValue()}`);
  renderTable();
  if(p.busted){
    log(`${p.name} ist busted!`);
    // auto advance
    setTimeout(()=> {
      advanceToNextPlayer();
      renderTable();
      processCurrentIfBot();
    }, 400);
  }
}
function playerStand(index){
  const p = players[index];
  p.stand = true;
  log(`${p.name} steht mit ${p.getBestValue()}`);
  advanceToNextPlayer();
  renderTable();
  processCurrentIfBot();
}

function advanceToNextPlayer(){
  // advance until find a player who needs to play (not stand, not busted) OR reach dealer end
  let i = currentPlayerIndex;
  const n = players.length;
  for(let t=1;t<=n;t++){
    i = (currentPlayerIndex + t) % n;
    const p = players[i];
    if(p.type === 'dealer' && modeSel.value === 'vsDealer'){
      // only dealer plays after all other players finished
      const othersDone = players.slice(0, players.length-1).every(x => x.stand || x.busted || x.blackjack);
      if(othersDone){
        currentPlayerIndex = i;
        return;
      } else continue;
    }
    if(!p.stand && !p.busted){
      currentPlayerIndex = i;
      return;
    }
  }
  // if none found, move to dealer (if exists)
  currentPlayerIndex = players.length - 1;
}

/* Bot logic for current player */
function processCurrentIfBot(){
  const p = players[currentPlayerIndex];
  if(!p) return;
  if(p.type === 'bot'){
    // simple bot: draw if < 16, else stand (or if 16 draw with 40% chance maybe)
    setStatus(`${p.name} (Bot) spielt...`);
    setTimeout(()=>{
      const val = p.getBestValue();
      if(val < 17){
        playerHit(currentPlayerIndex);
      } else {
        playerStand(currentPlayerIndex);
      }
    }, 600);
  } else if(p.type === 'dealer' && modeSel.value === 'vsDealer'){
    // dealer reveal then play dealer rules
    revealDealerAndPlay();
  } else {
    setStatus(`${p.name} ist am Zug.`);
  }

  // if all players done and no dealer to play (free mode), end round
  if(modeSel.value === 'free'){
    const anyActive = players.some(x => (!x.stand && !x.busted) && x.type !== 'dealer');
    if(!anyActive){
      // end round (compare scores)
      finalizeRound();
    }
  }
}

/* Dealer reveal and play */
function revealDealerAndPlay(){
  const dealer = players[players.length-1];
  dealer.revealed = true;
  renderTable();
  log('Dealer zeigt seine Karte.');
  // Dealer plays: hits until >= 17
  setTimeout(function dealerPlay(){
    const v = dealer.getBestValue();
    if(v < 17){
      const c = deck.draw();
      dealer.addCard(c);
      log(`Dealer zieht ${c.rank}${c.suit} → ${dealer.getBestValue()}`);
      renderTable();
      if(!dealer.busted){
        setTimeout(dealerPlay, 700);
      } else {
        log('Dealer busted!');
        finalizeRound();
      }
    } else {
      log(`Dealer steht mit ${v}`);
      finalizeRound();
    }
  }, 800);
}

/* Determine winners and show results */
function finalizeRound(){
  // reveal dealer if present
  if(modeSel.value === 'vsDealer'){
    const dealer = players[players.length-1];
    dealer.revealed = true;
    renderTable();
    // Compare every non-dealer player to dealer
    const dealerVal = dealer.getBestValue();
    log(`--- Ergebnis (Dealer: ${dealerVal}${dealer.busted ? ' BUST' : ''}) ---`);
    for(let i=0;i<players.length-1;i++){
      const p = players[i];
      const v = p.getBestValue();
      let result = '';
      if(p.busted) result = 'Verloren (busted)';
      else if(p.blackjack && !dealer.blackjack) result = 'Blackjack! (Gewonnen)';
      else if(dealer.busted) result = 'Dealer busted → Gewonnen';
      else if(p.blackjack && dealer.blackjack) result = 'Push (beide Blackjack)';
      else if(v > dealerVal) result = 'Gewonnen';
      else if(v === dealerVal) result = 'Push';
      else result = 'Verloren';
      log(`${p.name} (${v}) → ${result}`);
    }
  } else {
    // free mode: compare all human players — highest <=21 wins
    const contenders = players.map(p => ({name:p.name,val:p.getBestValue(),busted:p.busted,blackjack:p.blackjack}));
    // find best val <=21
    let best = -1;
    for(const c of contenders){
      if(!c.busted && c.val <= 21){
        if(c.val > best) best = c.val;
      }
    }
    const winners = contenders.filter(c => !c.busted && c.val === best);
    if(winners.length===0){
      log('Alle sind busted. Niemand gewinnt.');
    } else {
      const names = winners.map(w => w.name).join(', ');
      log(`Gewinner: ${names} mit ${best}`);
    }
  }
  // finalize UI
  setStatus('Runde beendet.');
  // disable action buttons
  currentPlayerIndex = -1;
  renderTable();
  dealBtn.disabled = false;
  nextBtn.disabled = true;
}

/* Buttons */
setupBtn.onclick = () => {
  renderPlayersConfig();
};
startBtn.onclick = () => {
  // gather settings
  mode = modeSel.value;
  showTotals = showTotalsCheckbox.checked;
  setupPlayersFromUI();
  startGame();
};
dealBtn.onclick = ()=> {
  // next round
  for(const p of players) p.resetHand();
  deck.reset();
  startGame();
};
nextBtn.onclick = ()=> {
  // allow to manually advance (useful if human stands)
  // If current is human and hasn't stood, nothing. Otherwise advance.
  if(currentPlayerIndex >=0 && players[currentPlayerIndex].type === 'human' && !players[currentPlayerIndex].stand && !players[currentPlayerIndex].busted){
    setStatus(`${players[currentPlayerIndex].name} ist noch am Zug.`);
    return;
  }
  advanceToNextPlayer();
  renderTable();
  processCurrentIfBot();
};
resetBtn.onclick = ()=> {
  location.reload();
};

showTotalsCheckbox.onchange = (e)=>{
  renderTable();
};

/* Init */
renderPlayersConfig();
setStatus('Bereit. Drücke Setup, passe Spieler an und starte das Spiel.');
</script>
</body>
</html>
